(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{408:function(t,a,e){"use strict";e.r(a);var s=e(44),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"常见问题与解答"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见问题与解答"}},[t._v("#")]),t._v(" 常见问题与解答")]),t._v(" "),e("h2",{attrs:{id:"configure-error-the-ngx-http-waf-module-module-requires-the-uthash-library"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#configure-error-the-ngx-http-waf-module-module-requires-the-uthash-library"}},[t._v("#")]),t._v(" ./configure: error: the ngx_http_waf_module module requires the uthash library.")]),t._v(" "),e("p",[t._v("本模块需要使用 "),e("code",[t._v("uthash")]),t._v("库，您可以通过包管理器安装 "),e("code",[t._v("uthash")]),t._v(" 相关的库。")]),t._v(" "),e("h3",{attrs:{id:"ubuntu-和-debian"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-和-debian"}},[t._v("#")]),t._v(" Ubuntu 和 Debian")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" update\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt-get")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" uthash-dev\n")])])]),e("h3",{attrs:{id:"centos8"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#centos8"}},[t._v("#")]),t._v(" Centos8")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("dnf --enablerepo"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("PowerTools "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" uthash-devel\n")])])]),e("h3",{attrs:{id:"alpine"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#alpine"}},[t._v("#")]),t._v(" Alpine")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("apk update\napk "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" --upgrade uthash-dev\n")])])]),e("h3",{attrs:{id:"其它"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[t._v("#")]),t._v(" 其它")]),t._v(" "),e("p",[t._v("参见 "),e("a",{attrs:{href:"https://pkgs.org/download/uthash-devel",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pkgs.org/download/uthash-devel"),e("OutboundLink")],1),t._v(" 和\n"),e("a",{attrs:{href:"https://pkgs.org/download/uthash-dev",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://pkgs.org/download/uthash-dev"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"本模块的性能如何"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本模块的性能如何"}},[t._v("#")]),t._v(" 本模块的性能如何？")]),t._v(" "),e("p",[t._v("IP 检查和 CC 防御花费常数时间，其它的检查花费 "),e("code",[t._v("O(nm)")]),t._v(" 的时间，其中 "),e("code",[t._v("n")]),t._v(" 是相关规则的条数，"),e("code",[t._v("m")]),t._v(" 为执行正则匹配的时间复杂度，但是每次检查过后会自动缓存本次检查的结果，下次检查相同的目标时就可以使用缓存而不是检查全部的规则。不会缓存 POST 请求体的检查结果。")]),t._v(" "),e("h2",{attrs:{id:"缓存的淘汰策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#缓存的淘汰策略"}},[t._v("#")]),t._v(" 缓存的淘汰策略")]),t._v(" "),e("p",[t._v("LRU")]),t._v(" "),e("h2",{attrs:{id:"post检测失效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#post检测失效"}},[t._v("#")]),t._v(" post检测失效")]),t._v(" "),e("p",[t._v("本模块出于性能考虑只会在 Post 请求体在内存中时检查，若不在内存中则跳过检查。\n您可以通过修改配置文件来解决这个问题。")]),t._v(" "),e("div",{staticClass:"language-nginx extra-class"},[e("pre",{pre:!0,attrs:{class:"language-nginx"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置 Post 请求体缓冲区大小")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_body_buffer_size")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("M"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 永远将请求体存放在内存中")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_body_in_file_only")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" off"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[e("a",{attrs:{href:"https://nginx.org/en/docs/http/ngx_http_core_module.html#client_body_buffer_size",target:"_blank",rel:"noopener noreferrer"}},[t._v("client_body_buffer_size 的说明"),e("OutboundLink")],1),t._v("\n和 "),e("a",{attrs:{href:"https://nginx.org/en/docs/http/ngx_http_core_module.html#client_body_in_file_only",target:"_blank",rel:"noopener noreferrer"}},[t._v("client_body_in_file_only 的说明"),e("OutboundLink")],1),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"fork-failed-while-spawning-worker-process-12-cannot-allocate-memory"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#fork-failed-while-spawning-worker-process-12-cannot-allocate-memory"}},[t._v("#")]),t._v(' fork() failed while spawning "worker process" (12: Cannot allocate memory)')]),t._v(" "),e("p",[t._v("可能是过多地使用 "),e("code",[t._v("nginx -s reload")]),t._v(" 导致的，本模块会在读取配置的时候申请一些内存，但是不知为何 "),e("code",[t._v("nginx -s reload")]),t._v(" 之后这些内存不会立即释放，所以短时间内频繁 "),e("code",[t._v("nginx -s reload")]),t._v(" 就极可能导致这个错误。")]),t._v(" "),e("h2",{attrs:{id:"可以在运行时修改规则么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#可以在运行时修改规则么"}},[t._v("#")]),t._v(" 可以在运行时修改规则么？")]),t._v(" "),e("p",[t._v("不可以，本模块只会在 nginx 启动时读取规则，之后不再读取。")]),t._v(" "),e("h2",{attrs:{id:"cdn-对-ip-检查的影响"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cdn-对-ip-检查的影响"}},[t._v("#")]),t._v(" CDN 对 IP 检查的影响")]),t._v(" "),e("p",[t._v("如果你使用 "),e("a",{attrs:{href:"https://nginx.org/en/docs/http/ngx_http_realip_module.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ngx_http_realip_module"),e("OutboundLink")],1),t._v(" 获取真实 IP 的话，则本模块在检查 IP 时就会使用真实的 IP。")]),t._v(" "),e("h2",{attrs:{id:"正则表达式拒绝服务攻击-redos"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#正则表达式拒绝服务攻击-redos"}},[t._v("#")]),t._v(" 正则表达式拒绝服务攻击（ReDoS）")]),t._v(" "),e("p",[t._v("ReDoS 是指使用的正则表达式存在缺陷时，攻击者可以使用一个精心构造的字符串来大量地消耗服务器的资源，比如导致正则引擎的灾难性的回溯。")]),t._v(" "),e("p",[t._v("本模块有两种措施可以用来缓解此类攻击。")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("本模块使用的 PCRE 库执行正则表达式，PCRE 在编译时即可指定主循环的计数器上限，超出上限自动停止。默认上限为 500000。你也可以在编译时手动调整，详见 "),e("a",{attrs:{href:"https://www.pcre.org/current/doc/html/pcre2build.html#SEC11",target:"_blank",rel:"noopener noreferrer"}},[t._v("pcre2 build man page"),e("OutboundLink")],1),t._v("。")])]),t._v(" "),e("li",[e("p",[t._v("本模块会缓存所有正则的检查结果（POST 检查除外），这样在不触发缓存淘汰流程的情况下，下次遇到用于攻击的字符串也无需再次执行正则表达式。")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);